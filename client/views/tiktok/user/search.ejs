<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../../partials/head', { title: "TikTok user search" }) %>
  </head>
  <script>
    var channels = [];
  </script>
  <body class="text-white bg-[#1b1b1b]">
    <%- include('../../partials/navbar') %>
    <main class="text-center m-4">
      <div class="bg-black p-4">
        <form>
          <input
            class="block p-4 w-full text-sm bg-neutral-800 rounded-lg border-neutral-600 placeholder-neutral-400 text-white focus:ring-blue-500 focus:border-blue-500"
            placeholder="Search for a TikTok user..."
            id="search"
          />
          <button
            class="text-white absolute right-10 top-[7.4rem] bg-pink-600 hover:bg-pink-800 focus:outline-none font-medium rounded-lg text-sm px-4 py-2"
            type="submit"
          >
            Search
          </button>
        </form>
      </div>
      <div class="flex flex-col gap-3 mt-4">
        <% [1, 2, 3, 4, 5].map(index => { %>
        <a
          class="channel items-center bg-black p-4 hover:scale-[1.025]"
          style="display: none"
        >
          <img
            src="https://yt3.ggpht.com/ytc/AMLnZu9ouu2eBFlCyh6lORj8YUCdNENJRst9IoU5sYf1Ig=s240-c-k-c0xffffffff-no-rj-mo"
            class="channel-icon rounded-full"
            width="80"
          />
          <div class="ml-3 text-left">
            <h1 class="channel-name font-bold text-4xl">MrBeast</h1>
            <p class="channel-id">100M subscribers</p>
          </div>
        </a>
        <% }) %>
      </div>
    </main>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script>
    $(document).ready(function () {
      $("form").submit(function (event) {
        event.preventDefault();

        var search = $("#search").val();

        channelSearch(search);
      });

      function channelSearch(search) {
        fetch("	https://api.subscriberwars.space/tiktok/search/" + search)
          .then((res) => res.json())
          .then((data) => {
            const elems = $(".channel");
            for (let i = 0; i < data.users.length; i++) {
              const elem = elems[i];
              elem.href = `/tiktok/user/${data.users[i].id}`;
              elem.style.display = "flex";

              const icon = elem.querySelector(".channel-icon");
              icon.src = data.users[i].avatar;

              const name = elem.querySelector(".channel-name");
              name.textContent = data.users[i].name;

              const id = elem.querySelector(".channel-id");
              id.textContent = data.users[i].uid;
            }
          });
      }
    });
  </script>
</html>
